

NOTES:

shell> cd ${DATATOOLS_ROOT}/devel/QPBA

shell> ./proc.sh 
CPPFLAGS = '-I./boost/qpba -I../../boost/vault/fpu -I../../boost/vault/endian -I. -I/scratch/sw/boost/install-1_44_0-Linux-i686-gcc44/include '
LDFLAGS  = '-fPIC -L/scratch/sw/boost/install-1_44_0-Linux-i686-gcc44/lib -lboost_serialization '

{{{
shell> ./prg1
a0 = {class=A: a=0; x=0; s=''}
a1 = {class=A: a=111; x=3.14159; s='pi'}
a2 = {class=A: a=222; x=inf; s='+infinity'}
a3 = {class=A: a=333; x=nan; s='Nan'}
a4 = {class=A: a=444; x=-inf; s='-infinity'}
Storing...

Loading...
a0 = {class=A: a=0; x=0; s=''}
a1 = {class=A: a=111; x=3.14159; s='pi'}
a2 = {class=A: a=222; x=inf; s='+infinity'}
a3 = {class=A: a=333; x=nan; s='Nan'}
a4 = {class=A: a=444; x=-inf; s='-infinity'}
}}}

Compare with sample reference file :
shell> diff prg1.data resources/prg1_ref.data 

shell> less prg1.xml

shell> od -t u1 prg1.data 
0000000 113 112  98  97   1   7   1   1   0   0   0   0   0   1 111   8
0000020 110 134  27 240 249  33   9  64   1   2 112 105   1 222   8   0
0000040   0   0   0   0   0 240 127   1   9  43 105 110 102 105 110 105
0000060 116 121   2  77   1   8 255 255 255 255 255 255 255 127   1   3
0000100  78  97 110   2 188   1   8   0   0   0   0   0   0 240 255   1
0000120   9  45 105 110 102 105 110 105 116 121
0000132

Binary format interpretation :

0000000 113 112  98  97   1   7   1   1   0   0   0   0   0   1 111   8
        _q_ _p_ _b_ _a_   __7__   __1__  _0_ _0_ _0_ _0_ _0_  _111_   _
         "magic bytes"   version                 .....a0....  .........

0000020 110 134  27 240 249  33   9  64   1   2 112 105   1 222   8   0
        ________3.14159________________   __2__ _p_ _i_   _222_   _____
        ..........a1...................................   .............

0000040   0   0   0   0   0 240 127   1   9  43 105 110 102 105 110 105
        ______+inf___________________ __9__ _-__i___n___f___i___n___i__ 
        ....................a2.........................................

0000060 116 121   2  77   1   8 255 255 255 255 255 255 255 127   1   3
        _t___y_  ____333____ _8_________nan____________________   __3__
        .......  ..............................a3......................

0000100  78  97 110   2 188   1   8   0   0   0   0   0   0 240 255   1
        _N_ _a_ _n_   ___444___  _8___________-inf_________________  __
        ...........   ..............................a4.................

0000120   9  45 105 110 102 105 110 105 116 121   
        9__ _-_ _i_ _n_ _f_ _i_ _n_ _i_ _t_ _y_  
        .......................................

Details:

1.77[2 bytes] == bin(1.01001101) == 333

127.255.255.255.255.255.255.255 ==
bin(01111111.11111111.11111111.11111111.11111111.11111111.11111111.11111111)
==  +inf

1.188[2 bytes] == bin(1.10111100) == 444

64 9 33 249 240 27 134 110 == bin:
01000000.00001001.00100001.11111001.11110000.00011011.10000110.01101110
+[ exp=1024 ][ mantissa=1 + (0.5 + 0.0625 + 0,0078125 +....) ~ 1,5703125]
 == + 2^(1024-1023) * 1,5703125 ~ 3.14159

127 240 0 0 0 0 0 0 == bin:
01111111.11110000.00000000.....
+[ exp=2047 ][0] = +inf
Infini: exponent==2^e-1 mantissa==0

127 255 255 .... == bin:
01111111.11111111.11111111.....
+[ exp=2047 ][!0] = NaN

255 240 0 0 0 0 0 0 == bin:
11111111.11110000.00000000.....
-[ exp=2047 ][0] = -inf


--
F. Mauger
2011-03-16
